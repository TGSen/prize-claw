{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "mask",
    "default",
    "type",
    "Node",
    "close",
    "layout",
    "item",
    "Prefab",
    "onLoad",
    "init",
    "listen",
    "empty",
    "name",
    "height",
    "on",
    "EventType",
    "TOUCH_START",
    "event",
    "stopPropagation",
    "scale",
    "TOUCH_END",
    "hide",
    "show",
    "node",
    "active",
    "opacity",
    "runAction",
    "fadeIn",
    "window",
    "_main",
    "api",
    "goodsList",
    "then",
    "res",
    "data",
    "ok",
    "r",
    "length",
    "i",
    "children",
    "list",
    "forEach",
    "child",
    "needEmpty",
    "getChildByName",
    "removeFromParent",
    "load",
    "instantiate",
    "addChild",
    "_goodsId",
    "id",
    "getComponent",
    "Label",
    "string",
    "promotionQuantity",
    "quantity",
    "price",
    "promotionState",
    "_bind",
    "target",
    "purchase",
    "location",
    "href",
    "monitor",
    "loader",
    "img",
    "promotionImg",
    "err",
    "results",
    "console",
    "log",
    "Sprite",
    "spriteFrame",
    "SpriteFrame",
    "getContent",
    "x",
    "setSiblingIndex",
    "sequence",
    "fadeOut",
    "callFunc"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "export default cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        mask: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        close: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        layout: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        item: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n        this.init()\r\n        this.listen()\r\n    },\r\n\r\n    init() {\r\n        /*\r\n        * 创建空借点\r\n        * 抵消 layout 的 coupon\r\n        */\r\n        this.empty = new cc.Node()\r\n        this.empty.name = 'empty'\r\n        this.empty.height = 26\r\n    },\r\n\r\n    listen() {\r\n        this.mask.on(\r\n            cc.Node.EventType.TOUCH_START,\r\n            event => {\r\n                event.stopPropagation()\r\n            }\r\n        )\r\n\r\n        /*\r\n        * 关闭按钮\r\n        */\r\n        this.close.on(\r\n            cc.Node.EventType.TOUCH_START,\r\n            () => {\r\n                this.close.scale = .95\r\n            }\r\n        )\r\n\r\n        this.close.on(\r\n            cc.Node.EventType.TOUCH_END,\r\n            () => {\r\n                this.close.scale = 1\r\n                this.hide()\r\n            }\r\n        )\r\n    },\r\n\r\n\r\n\r\n    show() {\r\n\r\n        // window._main.api.monitor('获取金币', 7)\r\n\r\n        if (this.node.active) this.node.opacity = 0\r\n        else {\r\n            this.node.active = true\r\n            this.node.opacity = 0\r\n        }\r\n        this.node.runAction(cc.fadeIn(.5))\r\n\r\n\r\n\r\n        window._main.api.goodsList()\r\n        .then(res => {\r\n            if (res.data.ok) {\r\n                if (res.data.r.length === 0) {\r\n                    return\r\n                }\r\n\r\n                let i = 0\r\n                const\r\n                    children = this.layout.children,\r\n                    list = res.data.r\r\n\r\n                children.forEach(child => {\r\n                    child.active = false\r\n                })\r\n\r\n                let needEmpty = false\r\n\r\n                // 有空节点则 remove\r\n                const empty = this.layout.getChildByName('empty')\r\n                empty ? empty.removeFromParent() : null\r\n\r\n                const load = () => {\r\n                    const\r\n                        item = list[i]\r\n                    let child = children[i]\r\n                    if (!child) {\r\n                        child = cc.instantiate(this.item)\r\n                        this.layout.addChild(child)\r\n                    }\r\n                    child.active = true\r\n\r\n                    child._goodsId = item.id\r\n\r\n                    child.getChildByName('layout').getChildByName('more')\r\n                        .getComponent(cc.Label).string = `${item.promotionQuantity}金币`\r\n\r\n                    child.getChildByName('layout').getChildByName('less')\r\n                        .getComponent(cc.Label).string = `${item.quantity}金币`\r\n\r\n                    child.getChildByName('btn').getChildByName('text')\r\n                        .getComponent(cc.Label).string = `￥${item.price / 100}`\r\n\r\n                    child.getChildByName('coupon').active =\r\n                    child.getChildByName('layout').getChildByName('less').active =\r\n                    item.promotionState\r\n\r\n\r\n                    if (!child._bind) {\r\n\r\n                        child._bind = true\r\n                        // 购买监听\r\n                        child.getChildByName('btn').on(\r\n                            cc.Node.EventType.TOUCH_START,\r\n                            function() {\r\n                                this.scale = .95\r\n                            }\r\n                        )\r\n\r\n                        child.getChildByName('btn').on(\r\n                            cc.Node.EventType.TOUCH_END,\r\n                            event => {\r\n                                event.target.scale = 1\r\n                                window._main.api.purchase(child._goodsId)\r\n                                .then(res => {\r\n                                    if (res.data.ok) {\r\n                                        location.href = res.data.r\r\n                                    }\r\n                                })\r\n\r\n                                window._main.api.monitor(item.name, 8, item.id)\r\n                            }\r\n                        )\r\n                    }\r\n\r\n                    if (item.promotionState && i === 0) {\r\n                        needEmpty = true\r\n                    }\r\n\r\n                    cc.loader.load([item.img, item.promotionImg], (err, results) => {\r\n                        if (err) console.log(err)\r\n                        else {\r\n                            child.getChildByName('image').getComponent(cc.Sprite)\r\n                                .spriteFrame = new cc.SpriteFrame(results.getContent(item.img))\r\n\r\n                            child.getChildByName('layout').x = -45\r\n\r\n                            // 折扣图标\r\n                            child.getChildByName('coupon').getComponent(cc.Sprite)\r\n                                .spriteFrame = new cc.SpriteFrame(results.getContent(item.promotionImg))\r\n                        }\r\n                        if (++i < list.length) load()\r\n                        else if (needEmpty) {\r\n                            this.layout.addChild(this.empty)\r\n                            this.empty.setSiblingIndex(0)\r\n                        }\r\n                    })\r\n                }\r\n                load()\r\n\r\n            }\r\n        })\r\n    },\r\n\r\n    hide() {\r\n        this.node.runAction(cc.sequence(\r\n            cc.fadeOut(.5),\r\n            cc.callFunc(() => {\r\n                this.node.active = false\r\n            })\r\n        ))\r\n    }\r\n})\r\n"
  ]
}